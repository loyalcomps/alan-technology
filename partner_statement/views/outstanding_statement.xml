<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2018 ForgeFlow, S.L. (https://www.forgeflow.com)
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl). -->
<odoo>


    <template id="external_layout_standard_stmnt">
        <div t-attf-class="header o_company_#{company.id}_layout" t-att-style="report_header_style">
            <div class="row">
                <div class="col-3 mb4">
                    <img t-if="company.logo" t-att-src="image_data_uri(company.logo)" style="max-height: 70px;"
                         alt="Logo"/>
                </div>
                <div class="col-9 text-end" style="margin-top:22px;" t-field="company.report_header" name="moto"/>
            </div>
            <div t-if="company.logo or company.report_header" class="row zero_min_height">
                <div class="col-12">
                    <div style="border-bottom: 1px solid black;"/>
                </div>
            </div>
            <div class="row">
                <div class="col-6" name="company_address">
                    <ul class="list-unstyled">
                        <li t-if="company.is_company_details_empty">
                            <t t-esc="company.partner_id"
                               t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": true}'/>
                        </li>
                        <li t-else="">
                            <t t-esc="company.company_details"/>
                        </li>
                        <li t-if="forced_vat">
                            <t t-esc="company.country_id.vat_label or 'Tax ID'"/>:
                            <span t-esc="forced_vat"/>
                        </li>
                    </ul>
                </div>
                <div class="col-6">

                </div>
            </div>
        </div>

        <div t-attf-class="article o_report_layout_standard o_company_#{company.id}_layout {{  'o_report_layout_background' if company.layout_background in ['Geometric', 'Custom']  else  '' }}"
             t-attf-style="background-image: url({{ 'data:image/png;base64,%s' % company.layout_background_image.decode('utf-8') if company.layout_background_image and company.layout_background == 'Custom' else '/base/static/img/bg_background_template.jpg' if company.layout_background == 'Geometric' else ''}});"
             t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id"
             t-att-data-oe-lang="o and o.env.context.get('lang')">
            <div class="pt-5">
                <!-- This div ensures that the address is not cropped by the header. -->
                <t t-call="web.address_layout"/>
            </div>
            <t t-out="0"/>
        </div>

        <div t-attf-class="footer o_standard_footer o_company_#{company.id}_layout">
            <div class="text-center" style="border-top: 1px solid black;">
                <ul class="list-inline mb4">
                    <div t-field="company.report_footer"/>
                </ul>

                <div t-if="report_type == 'pdf'" class="text-muted">
                    Page:
                    <span class="page"/>
                    /
                    <span class="topage"/>
                </div>
                <div t-if="report_type == 'pdf' and display_name_in_footer" class="text-muted">
                    <span t-field="o.name"/>
                </div>
            </div>
        </div>
    </template>

    <template id="external_layout_stmnt">
        <t t-if="not o" t-set="o" t-value="doc"/>

        <t t-if="not company">
            <!-- Multicompany -->
            <t t-if="company_id">
                <t t-set="company" t-value="company_id"/>
            </t>
            <t t-elif="o and 'company_id' in o and o.company_id.sudo()">
                <t t-set="company" t-value="o.company_id.sudo()"/>
            </t>
            <t t-else="else">
                <t t-set="company" t-value="res_company"/>
            </t>
        </t>

        <!--        <t t-if="company.external_report_layout_id" t-call="{{company.external_report_layout_id.sudo().key}}"><t t-out="0"/></t>-->
        <t t-call="partner_statement.external_layout_standard_stmnt">
            <t t-out="0"/>
        </t>

    </template>

    <template id="partner_statement.outstanding_statement_document">
        <t t-call="partner_statement.external_layout_stmnt">
            <t t-set="o" t-value="o.with_context({'lang': lang})"/>
            <div class="page" style="margin-top:-4%">
                <!-- <t t-set="address"> -->
                <table align="right" class="table-borderless">
                    <tr>
                        <td>
                            <t
                                    t-esc="get_inv_addr(o)"
                                    t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'
                            />
                            <div t-if="o.vat" class="mt16"><t
                                    t-esc="company.country_id.vat_label or 'Tax ID'"
                            />:
                                <span t-field="o.vat"/>
                            </div>
                        </td>
                    </tr>
                </table>
                <!-- </t> -->
                <!--                <div class="oe_structure"/>-->
                <h1 class="text-center" style="font-size:16px">
                    <strong>STATEMENT OF A/C</strong>
                </h1>
                <t t-if="salesperson_wise">
                    <div class="col-12">
                        <strong>Salesperson:</strong>
                        <b>
                            <span t-esc="salesperson_name"/>
                        </b>
                    </div>
                    <br/>
                </t>

                <!--                <div id="informations" class="row mt32 mb32">-->

                <!--&lt;!&ndash;                    <div class="col-12 bm-2">&ndash;&gt;-->
                <!--&lt;!&ndash;                        <strong>To,</strong>&ndash;&gt;-->
                <!--&lt;!&ndash;                        <p>&ndash;&gt;-->
                <!--&lt;!&ndash;                            <b>&ndash;&gt;-->
                <!--&lt;!&ndash;                                &lt;!&ndash;                                &#160;&#160;<span t-esc="o.customer_code" class="m-0"/>&#160;&#160;&#160;&ndash;&gt;&ndash;&gt;-->
                <!--&lt;!&ndash;                                <span t-field="o.name"/>&ndash;&gt;-->
                <!--&lt;!&ndash;                            </b>&ndash;&gt;-->
                <!--&lt;!&ndash;                            <br/>&ndash;&gt;-->
                <!--&lt;!&ndash;                            &#160;&#160;&#160;<span t-esc="o.street"/>&ndash;&gt;-->
                <!--&lt;!&ndash;                        </p>&ndash;&gt;-->
                <!--&lt;!&ndash;                    </div>&ndash;&gt;-->
                <!--                </div>-->
                <!--                <br/>-->
                <!--                <br/>-->
                <!--                <div id="partner_info" class="row mt32 mb32">-->
                <!--                    <div class="col-4 bm-2">-->
                <!--                        <strong>Date :</strong>-->
                <!--                        <b>-->
                <!--                            &#160;&#160;<span t-esc="date_end" t-options='{"widget": "date","format": "dd/MM/yyyy"}' class="m-0"/>-->
                <!--                        </b>-->
                <!--                    </div>-->
                <!--                    <div class="col-9 bm-2">-->
                <!--                        <strong>Fax :</strong>-->
                <!--                        <b>-->
                <!--                            &#160;&#160;<span t-esc="o.email" class="m-0"/>-->
                <!--                        </b>-->
                <!--                    </div>-->
                <!--                </div>-->
                <!--                <br/>-->
                <t t-if="d['currencies']">
                    <br/>
                    <t t-foreach="d['currencies'].items()" t-as="currency">
                        <t t-set="display_currency" t-value="Currencies[currency[0]]"/>
                        <t t-set="currency" t-value="currency[1]"/>
                        <p>
                            Please find the Statement of A/C &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
                            <!--                            <span-->
                            <!--                                    t-esc="'' if  account_type == 'asset_receivable' else 'Supplier '"-->
                            <!--                            />-->
                            As on
                            <span t-esc="d['end']"/>
                            in
                            <span t-esc="o.env.company.currency_id.name"/>
                        </p>
                        <br/>
                        <table width="100%" class="table table-condensed table-statement"
                               style="font-size:14px;border-bottom: 1px solid black;border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;">
                            <thead>
                                <tr>
                                    <strong>
                                        <th width="8%">
                                            <b>Sl No</b>
                                        </th>
                                        <th width="8%">
                                            <b>Inv Date</b>
                                        </th>
                                        <th width="20%">
                                            <b>Invoice / Reference</b>
                                        </th>
                                        <th width="25%">
                                            <b>LPO / Description</b>
                                        </th>

                                        <th style="text-align:right">
                                            <b>Opening Amount</b>
                                        </th>
                                        <th style="text-align:right">
                                            <b>Payment Received</b>
                                        </th>
                                        <th style="text-align:right">
                                            <b>Pending Amount</b>
                                        </th>
                                        <th style="text-align:right">
                                            <b>Balance Amount</b>
                                        </th>
                                        <th style="text-align:center" align="left">
                                            <b>Due Days</b>
                                        </th>
                                        <!--                                        <th class="amount">-->
                                        <!--                                            <b>PDC Amt</b>-->
                                        <!--                                        </th>-->
                                    </strong>
                                </tr>
                            </thead>
                            <tbody style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px;border-bottom: 1px solid black;">
                                <t t-set="sl_no" t-value="1"/>
                                <tr
                                        t-foreach="currency['lines']"
                                        t-as="line"
                                        t-att-class="'statement-blocked' if line['blocked'] else ''">
                                    <td>
                                        <span t-esc="sl_no"/>
                                    </td>

                                    <t t-set="sl_no" t-value="sl_no+1"/>
                                    <td>
                                        <span t-esc="line['date']"/>
                                    </td>
                                    <!--                                    <td>-->
                                    <!--                                        <span t-esc="line['journal']"/>-->
                                    <!--                                    </td>-->
                                    <td>
                                        <span t-esc="line['move_id']"/>
                                    </td>
                                    <td>
                                        <span t-esc="line['ref']"/>
                                    </td>

                                    <!--                                    <td>-->
                                    <!--                                        <t t-if="line['name'] != '/'">-->
                                    <!--                                            <t t-if="not line['ref']">-->
                                    <!--                                                <span t-esc="line['name']"/>-->
                                    <!--                                            </t>-->
                                    <!--                                            <t t-if="line['ref'] and not line['name']">-->
                                    <!--                                                <span t-esc="line['ref']"/>-->
                                    <!--                                            </t>-->
                                    <!--                                            <t t-if="line['ref'] and line['name']">-->
                                    <!--                                                <t t-if="line['name'] not in line['ref'] or line['name'] == line['ref']">-->
                                    <!--                                                    <span t-esc="line['name']"/>-->
                                    <!--                                                </t>-->
                                    <!--                                                <t t-if="line['ref'] not in line['name']">-->
                                    <!--                                                    <span t-esc="line['ref']"/>-->
                                    <!--                                                </t>-->
                                    <!--                                            </t>-->
                                    <!--                                        </t>-->
                                    <!--                                        <t t-if="line['name'] == '/'">-->
                                    <!--                                            <span t-esc="line['ref']"/>-->
                                    <!--                                        </t>-->
                                    <!--                                    </td>-->
                                    <td class="amount">
                                        <span t-esc="'{0:,.2f}'.format(line['amount'])"
                                        />
                                    </td>
                                  <td class="amount">
                                        <t t-set="payment_received" t-value="line['amount'] - line['open_amount']"/>
                                        <span t-esc="'{0:,.2f}'.format(payment_received)"/>
                                    </td>

                                    <td class="amount">
                                        <span t-esc="'{0:,.2f}'.format(line['open_amount'])"/>
                                        <!--                                              t-options="{'widget': 'monetary', 'display_currency': display_currency}"-->
                                        <!--                                        />-->
                                    </td>
                                    <td class="amount">
                                        <span
                                                t-esc="'{0:,.2f}'.format(line['balance'])"/>
                                        <!--                                                t-options="{'widget': 'monetary', 'display_currency': display_currency}"-->

                                    </td>
                                    <t t-set="today" t-value="datetime.datetime.now(datetime.timezone.utc)"/>
                                    <td style="text-align:center">
                                        <t t-set="date_maturity"
                                           t-value="datetime.datetime.strptime(line['date_maturity'], '%d/%m/%Y').replace(tzinfo=datetime.timezone.utc)"/>
                                        <t t-set="days_difference" t-value="(today - date_maturity).days"/>
                                        <t t-esc="days_difference"/>
                                        Days
                                    </td>
                                    <!--                                    <td class="amount">-->
                                    <!--                                        <span-->
                                    <!--                                                t-esc="line['balance']"-->
                                    <!--                                                t-options="{'widget': 'monetary', 'display_currency': display_currency}"-->
                                    <!--                                        />-->
                                    <!--                                    </td>-->
                                </tr>
                                <tr>
                                    <td></td>
                                    <td>
                                        <span t-esc="d['end']"/>
                                    </td>
                                    <td/>
                                    <td>
                                        Ending Balance
                                    </td>
                                    <td/>
                                    <td/>
                                    <td>

                                    </td>
                                    <td class="amount">
                                        <span t-esc="'{0:,.2f}'.format(currency['amount_due'])"/>
                                        <!--                                                t-options="{'widget': 'monetary', 'display_currency': display_currency}"/>-->
                                    </td>

                                    <td class="amount"/>
                                    <!--                                    <td/>-->
                                    <!--                                    <td/>-->

                                </tr>
                            </tbody>
                        </table>
                        <t
                                t-call="partner_statement.aging_buckets"
                                t-if="currency['buckets']"/>
                    </t>
                </t>
                <p t-if="d.get('no_entries')">
                    <strong>The partner doesn't have due entries.</strong>
                </p>

                <!--                <t t-if="pdc_data">-->
                <!--                    <table class="table table-condensed table-statement">-->
                <!--                        <thead style="border-bottom: 1px solid black;border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;">-->
                <!--                            <tr>-->
                <!--                                <strong>-->
                <!--                                    <th>-->
                <!--                                        <b>Name</b>-->
                <!--                                    </th>-->
                <!--                                    <th>-->
                <!--                                        <b>Date</b>-->
                <!--                                    </th>-->
                <!--                                    <th>-->
                <!--                                        <b>Type</b>-->
                <!--                                    </th>-->
                <!--                                    <th>-->
                <!--                                        <b>Customer</b>-->
                <!--                                    </th>-->
                <!--                                    <th>-->
                <!--                                        <b>Amount</b>-->
                <!--                                    </th>-->
                <!--                                    <th>-->
                <!--                                        <b>Status</b>-->
                <!--                                    </th>-->
                <!--                                </strong>-->
                <!--                            </tr>-->
                <!--                        </thead>-->
                <!--                        <tbody style="border-top: 1px solid black;border-left: 1px solid black;border-right: 1px solid black;">-->
                <!--                            <tr-->
                <!--                                    t-foreach="pdc_data"-->
                <!--                                    t-as="pdc"-->
                <!--                                    t-att-class="'statement-blocked' if line['blocked'] else ''">-->
                <!--                                <td>-->
                <!--                                    <span t-esc="pdc['name']"/>-->
                <!--                                </td>-->
                <!--                                <td>-->
                <!--                                    <span t-esc="pdc['payment_date']"/>-->
                <!--                                </td>-->
                <!--                                <td>-->
                <!--                                    <span t-esc="pdc['payment_type']"/>-->
                <!--                                </td>-->
                <!--                                <td>-->
                <!--                                    <span t-esc="pdc['partner_id']"/>-->
                <!--                                </td>-->
                <!--                                <td>-->
                <!--                                    <span t-esc="pdc['payment_amount']"/>-->
                <!--                                </td>-->
                <!--                                <td>-->
                <!--                                    <span t-esc="pdc['state']"/>-->
                <!--                                </td>-->
                <!--                            </tr>-->
                <!--                        </tbody>-->
                <!--                    </table>-->
                <!--                </t>-->


                <div style="float:bottom;bottom:90;">
                    <p>
                        This is a computer generated document and does not need any signatures. Your immediate payment
                        will be highly appreciated.
                    </p>
                </div>
                <p style="page-break-after:always"/>
            </div>
            <div class="footer">
                <div class="row">
                    <div class="col col-md-auto" align="left">
                        <small>
                            Print Date:
                            <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"
                                  align="left"/>
                        </small>
                    </div>
                </div>
                <div class="col col-md-auto" align="right">
                    <small align="right">
                        <span>Page</span>
                        <span class="page"/>
                        of
                        <span class="topage"/>
                    </small>
                </div>
            </div>
        </t>
    </template>
    <template id="outstanding_statement">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-set="d" t-value="data.get(o.id)"/>
                <t
                        t-call="partner_statement.outstanding_statement_document"
                        t-lang="o.lang"
                />
            </t>
        </t>
    </template>
    <record id="outstanding_paper_format_alan" model="report.paperformat">
        <field name="name">Outstanding Paper Format Alan</field>
        <field name="default" eval="True"/>
        <field name="format">A4</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Landscape</field>
        <field name="margin_top">45</field>
        <field name="margin_bottom">20</field>
        <field name="margin_left">7</field>
        <field name="margin_right">7</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">45</field>
        <field name="dpi">90</field>
    </record>

    <record id="action_print_outstanding_statement" model="ir.actions.report">
<!--        <field name="name">Outstanding Statement</field>-->
        <field name="model">res.partner</field>
        <field name="report_name">partner_statement.outstanding_statement</field>
<!--        <field name="print_report_name">-->
<!--            'Outstandingeeeeeeeeeeeeeeeeeeee statement - %s' % (object.name)-->
<!--        </field>-->
        <!--        <field name="print_report_name">(object.state in ('draft', 'sent') and 'Quotation - %s' % (object.name)) or-->
        <!--            'Order - %s' % (object.name)-->
        <!--        </field>-->

        <field name="report_type">qweb-pdf</field>
        <field name="report_file">partner_statement.outstanding_statement</field>
        <field name="paperformat_id" ref="partner_statement.outstanding_paper_format_alan"></field>
    </record>
    <record id="action_print_outstanding_statement_html" model="ir.actions.report">
        <field name="name">Outstanding Statement</field>
        <field name="model">res.partner</field>
        <field name="report_name">partner_statement.outstanding_statement</field>
        <field name="report_type">qweb-html</field>
        <field name="report_file">partner_statement.outstanding_statement</field>
    </record>
    <record id="action_print_outstanding_statement_xlsx" model="ir.actions.report">
        <field name="name">Outstanding Statement XLSX</field>
        <field name="model">res.partner</field>
        <field name="type">ir.actions.report</field>
        <field name="report_name">p_s.report_outstanding_statement_xlsx</field>
        <field name="report_type">xlsx</field>
        <field name="report_file">report_outstanding_statement</field>
    </record>
</odoo>